<!-- ğŸµ éŸ³ä¹æ’­æ”¾å™¨ -->
<div id="music-player" class="aplayer player"
     data-id="17401109156"
     data-server="netease"
     data-type="playlist"
     data-autoplay="false">
</div>

<!-- ğŸ§ æŒ‰é’® -->
<button id="toggle-player-fixed" aria-pressed="false">ğŸ§ æ”¶èµ·</button>

<!-- ğŸ”§ JSè„šæœ¬ -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>

<script>
(() => {
  // é˜²æ­¢é‡å¤åˆå§‹åŒ–
  if (window._musicPlayerInitialized) return;
  window._musicPlayerInitialized = true;

  const container = document.getElementById('music-player');
  const btnFixed = document.getElementById('toggle-player-fixed');
  let hidden = false;

  // === è½½å…¥æ—¶æ¢å¤æ˜¾ç¤ºçŠ¶æ€ ===
  try {
    const saved = localStorage.getItem('music_player_hidden');
    if (saved === 'true') {
      hidden = true;
      container.classList.add('hidden');
      btnFixed.textContent = 'ğŸ§ å±•å¼€';
      btnFixed.classList.remove('open');
    } else {
      btnFixed.textContent = 'ğŸ§ æ”¶èµ·';
      btnFixed.classList.add('open');
    }
  } catch (e) {}

  // === åˆ‡æ¢æŒ‰é’® ===
  btnFixed.addEventListener('click', () => {
    hidden = !hidden;
    if (hidden) {
      container.classList.add('hidden');
      btnFixed.textContent = 'ğŸ§ å±•å¼€';
      btnFixed.classList.remove('open');
    } else {
      container.classList.remove('hidden');
      btnFixed.textContent = 'ğŸ§ æ”¶èµ·';
      btnFixed.classList.add('open');
    }
    try {
      localStorage.setItem('music_player_hidden', hidden ? 'true' : 'false');
    } catch (e) {}
  });

  // === é˜²æ­¢ PJAX é¡µé¢åˆ‡æ¢æ—¶é‡æ–°åŠ è½½éŸ³ä¹ ===
  document.addEventListener('pjax:send', () => {
    // åœ¨åˆ‡æ¢é¡µé¢æ—¶æš‚åœ Meting é‡æ–°åŠ è½½
    if (window.meting_api && window.meting_api.destroy) {
      // Meting 1.1.0 æ²¡æš´éœ² destroyï¼Œè¿™é‡Œåªæ˜¯å®‰å…¨å¤„ç†
      console.log('[Music] PJAX åˆ‡æ¢ä¸­ï¼Œä¸é‡å»ºæ’­æ”¾å™¨');
    }
  });

  console.log('[Music] æ’­æ”¾å™¨åˆå§‹åŒ–å®Œæˆï¼ˆä»…åˆå§‹åŒ–ä¸€æ¬¡ï¼‰');
})();
</script>    if (hidden) {
      container.classList.add('hidden');
      btnFixed.textContent = 'ğŸ§ å±•å¼€';
      btnFixed.classList.remove('open');
    } else {
      container.classList.remove('hidden');
      btnFixed.textContent = 'ğŸ§ æ”¶èµ·';
      btnFixed.classList.add('open');
    }
    try { localStorage.setItem('music_player_hidden', hidden ? 'true' : 'false'); } catch(e){}
  });
})();
</script>
